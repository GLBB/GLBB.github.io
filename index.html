<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>我的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="记录生活点滴">
<meta property="og:type" content="website">
<meta property="og:title" content="我的博客">
<meta property="og:url" content="http://glbb.github.io/index.html">
<meta property="og:site_name" content="我的博客">
<meta property="og:description" content="记录生活点滴">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="我的博客">
<meta name="twitter:description" content="记录生活点滴">
  
    <link rel="alternate" href="/atom.xml" title="我的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">我的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">一天进步一点</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://glbb.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-监听器" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/03/02/监听器/" class="article-date">
  <time datetime="2018-03-02T12:11:53.000Z" itemprop="datePublished">2018-03-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/03/02/监听器/">监听器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="6种监听器"><a href="#6种监听器" class="headerlink" title="6种监听器"></a>6种监听器</h2><h3 id="监听器有哪些"><a href="#监听器有哪些" class="headerlink" title="监听器有哪些"></a>监听器有哪些</h3><p>第一维度：按照被监听的对象划分：ServletRequest域   HttpSession域       ServletContext域<br>第二维度：监听的内容分：监听域对象的创建与销毁的    监听域对象的属性变化的</p>
<p><img src="http://t2.qpic.cn/mblogpic/038d7b6852d089910450/460" alt=""></p>
<p>监听ServletContext域的创建与销毁的监听器ServletContextListener<br>1）ServletContext域的生命周期<br>何时创建：服务器启动创建<br>何时销毁：服务器关闭销毁</p>
<p>2）监听器的编写步骤（重点）：<br>a、编写一个监听器类去实现监听器接口<br>b、覆盖监听器的方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.listener;</div><div class="line"></div><div class="line">import java.text.ParseException;</div><div class="line">import java.text.SimpleDateFormat;</div><div class="line">import java.util.Date;</div><div class="line">import java.util.Timer;</div><div class="line">import java.util.TimerTask;</div><div class="line"></div><div class="line">import javax.servlet.ServletContextEvent;</div><div class="line">import javax.servlet.ServletContextListener;</div><div class="line"></div><div class="line">public class MyServletContextListener implements ServletContextListener&#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void contextInitialized(ServletContextEvent sce) &#123;</div><div class="line">//		System.out.println(&quot;ServletContext创建了&quot;);</div><div class="line">		Timer timer = new Timer();</div><div class="line">		SimpleDateFormat formate = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;);</div><div class="line">		Date date = null;</div><div class="line">		try &#123;</div><div class="line">			date = formate.parse(&quot;2018-1-27 19:03:00&quot;);</div><div class="line">		&#125; catch (ParseException e) &#123;</div><div class="line">			// TODO Auto-generated catch block</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		timer.scheduleAtFixedRate(new TimerTask() &#123;</div><div class="line">			@Override</div><div class="line">			public void run() &#123;</div><div class="line">				System.out.println(&quot;我的定时器&quot;);</div><div class="line">			&#125;</div><div class="line">		&#125;, date, 500000);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void contextDestroyed(ServletContextEvent sce) &#123;</div><div class="line">		System.out.println(&quot;servletContext销毁了&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>c、需要在web.xml中进行配置—注册<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;listener&gt;</div><div class="line">	&lt;listener-class&gt;cn.itcast.listener.MyServletContextListener&lt;/listener-class&gt;</div><div class="line">&lt;/listener&gt;</div></pre></td></tr></table></figure></p>
<p>其中 HttpSessionListener 和 requestListener同理<br>其中注意：<br>jsp页面默认会创建session</p>
<p>还有这三个域（request,session,servletContext）的属性监听器<br>如servletContext域中的属性监听器为例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.listener.attribute;</div><div class="line"></div><div class="line">import javax.servlet.ServletContextAttributeEvent;</div><div class="line">import javax.servlet.ServletContextAttributeListener;</div><div class="line"></div><div class="line">public class MyServletAttributeListener implements ServletContextAttributeListener &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void attributeAdded(ServletContextAttributeEvent scae) &#123;</div><div class="line">		//获得增加的属性和值</div><div class="line">		System.out.println(scae.getName()); </div><div class="line">		System.out.println(scae.getValue());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void attributeRemoved(ServletContextAttributeEvent scae) &#123;</div><div class="line">		//获得域中被删除的属性和值</div><div class="line">		System.out.println(scae.getName());</div><div class="line">		System.out.println(scae.getValue());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void attributeReplaced(ServletContextAttributeEvent scae) &#123;</div><div class="line">		//获得被替换的属性和被替换之前值</div><div class="line">		System.out.println(scae.getName());</div><div class="line">		System.out.println(scae.getValue());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>需要在web.xml文件中配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;listener&gt;</div><div class="line">	&lt;listener-class&gt;cn.itcast.listener.attribute.MyServletAttributeListener&lt;/listener-class&gt;</div><div class="line">&lt;/listener&gt;</div></pre></td></tr></table></figure></p>
<p>其他两种属性监听器同理</p>
<h2 id="其余两种监听器"><a href="#其余两种监听器" class="headerlink" title="其余两种监听器"></a>其余两种监听器</h2><p>HttpSessionBindingListener 监听对象被加入session域中或从session域中移除的监听器<br>例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.domain;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpSessionBindingEvent;</div><div class="line">import javax.servlet.http.HttpSessionBindingListener;</div><div class="line"></div><div class="line">public class Person implements HttpSessionBindingListener&#123;</div><div class="line">	String name;</div><div class="line"></div><div class="line">	public String getName() &#123;</div><div class="line">		return name;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setName(String name) &#123;</div><div class="line">		this.name = name;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//被加入session会调用这个方法</div><div class="line">	@Override</div><div class="line">	public void valueBound(HttpSessionBindingEvent event) &#123;</div><div class="line">		System.out.println(&quot;将一个person加入session域中&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//从session中移除会调用这个方法</div><div class="line">	@Override</div><div class="line">	public void valueUnbound(HttpSessionBindingEvent event) &#123;</div><div class="line">		System.out.println(&quot;将一个person从session域移除中&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这种监视器不需要配置web.xml文件</p>
<p>还有一种监听器<br>监听session域中对象的钝化和活化<br>钝化状态：是将session内存中的对象持久化（序列化）到磁盘<br>活化状态：就是将磁盘上的对象再次恢复到session内存中<br>例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.domain;</div><div class="line"></div><div class="line">import java.io.Serializable;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpSessionActivationListener;</div><div class="line">import javax.servlet.http.HttpSessionEvent;</div><div class="line"></div><div class="line">public class Customer implements Serializable,HttpSessionActivationListener&#123;</div><div class="line"></div><div class="line">	private static final long serialVersionUID = 1L;</div><div class="line"></div><div class="line">	private String name;</div><div class="line"></div><div class="line">	public String getName() &#123;</div><div class="line">		return name;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	public void setName(String name) &#123;</div><div class="line">		this.name = name;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//被钝化</div><div class="line">	@Override</div><div class="line">	public void sessionWillPassivate(HttpSessionEvent se) &#123;</div><div class="line">		System.out.println(&quot;session中的对象被钝化了&quot;);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//被活化</div><div class="line">	@Override</div><div class="line">	public void sessionDidActivate(HttpSessionEvent se) &#123;</div><div class="line">		System.out.println(&quot;session中的对象被活化了&quot;);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中必须实现Serializable接口才能将对象写入到磁盘中<br>将该对象加入Session中，正常关闭tomcat服务器，这个对象就被写入到磁盘中了<br>正常启动服务器，这个对象就被活化了<br>可以在这个目录下看到钝化的对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tomcat\work\Catalina\localhost\day23</div></pre></td></tr></table></figure></p>
<p>这个是通过服务器关闭钝化，启动活化</p>
<p>可以通过配置文件来钝化活化<br>在META-INF目录下，新建context.xml文件<br>里面可以添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;Context&gt;</div><div class="line"> &lt;!-- maxIdleSwap:session中的对象多长时间不使用就钝化 --&gt;</div><div class="line"> &lt;!-- directory:钝化后的对象的文件写到磁盘的哪个目录下  配置钝化的对象文件在												work/catalina/localhost/钝化文件 --&gt;</div><div class="line"> &lt;Manager className=&quot;org.apache.catalina.session.PersistentManager&quot; 																				maxIdleSwap=&quot;1&quot;&gt;</div><div class="line">  &lt;Store className=&quot;org.apache.catalina.session.FileStore&quot; directory=&quot;itcast205&quot; /&gt;</div><div class="line"> &lt;/Manager&gt;</div><div class="line">&lt;/Context&gt;</div></pre></td></tr></table></figure></p>
<p>org.apache.catalina.session.PersistentManager这个是tomcat提供的钝化的一个类，其中maxIdleSwap设置的值单位是分钟，其中org.apache.catalina.session.FileStore，也是tomcat提供的，directory指的是钝化的对象放在work目录下的web应用目录下的哪个文件夹，不需要提前创建这个文件夹，它会自动创建</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/03/02/监听器/" data-id="cje9wqizt001apsvd6yivenb0" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-javamail发送邮件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/31/javamail发送邮件/" class="article-date">
  <time datetime="2018-01-31T12:46:54.000Z" itemprop="datePublished">2018-01-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/31/javamail发送邮件/">javamail发送邮件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ol>
<li>打开QQ邮件<br>选择设置<br>选择账户<br>找到 POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务<br>开启POP3/SMTP服务<br>记住授权码<br>编写代码<br>导入mail.jar<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">import java.security.GeneralSecurityException;</div><div class="line">import java.util.Properties;</div><div class="line"></div><div class="line">import javax.mail.Message;</div><div class="line">import javax.mail.MessagingException;</div><div class="line">import javax.mail.Session;</div><div class="line">import javax.mail.Transport;</div><div class="line">import javax.mail.internet.AddressException;</div><div class="line">import javax.mail.internet.InternetAddress;</div><div class="line">import javax.mail.internet.MimeMessage;</div><div class="line"></div><div class="line">import com.sun.mail.util.MailSSLSocketFactory;</div><div class="line"></div><div class="line">public class MailTest &#123;</div><div class="line">	public static void main(String[] args) throws AddressException, MessagingException, GeneralSecurityException &#123;</div><div class="line">		Properties properties = new Properties();</div><div class="line">		// 开启debug调试，以便在控制台查看</div><div class="line">		properties.setProperty(&quot;mail.debug&quot;, &quot;true&quot;);</div><div class="line">		// 设置邮件传输协议</div><div class="line">		properties.setProperty(&quot;mail.transport.protocol&quot;, &quot;smtp&quot;);</div><div class="line">		// 设置邮件服务器主机名</div><div class="line">		properties.setProperty(&quot;mail.host&quot;, &quot;smtp.qq.com&quot;);</div><div class="line">		// 发送服务器需要身份验证</div><div class="line">		properties.setProperty(&quot;mail.smtp.auth&quot;, &quot;true&quot;);</div><div class="line">		</div><div class="line">		// 开启SSL加密，否则会失败</div><div class="line">		MailSSLSocketFactory factory = new MailSSLSocketFactory();</div><div class="line">		factory.setTrustAllHosts(true);</div><div class="line">		properties.put(&quot;mail.smtp.ssl.enable&quot;, &quot;true&quot;);</div><div class="line">		properties.put(&quot;mail.smtp.ssl.socketFactory&quot;, factory);</div><div class="line">		</div><div class="line">		// 创建session</div><div class="line">		Session session = Session.getInstance(properties);</div><div class="line">		// 通过session得到transport对象</div><div class="line">		Transport transport = session.getTransport();</div><div class="line">		// 连接邮件服务器：邮箱类型，帐号，授权码代替密码（更安全）</div><div class="line">		transport.connect(&quot;smtp.qq.com&quot;,&quot;123456789&quot;,&quot;sofjsfsksjfl&quot;);</div><div class="line">		// 123456789是QQ账号  sofjsfsksjfl 这个是授权码</div><div class="line">		</div><div class="line">		// 创建邮件对象</div><div class="line">		Message message = new MimeMessage(session);</div><div class="line">		// 指明邮件的发件人</div><div class="line">		message.setFrom(new InternetAddress(&quot;123456789@qq.com&quot;));</div><div class="line">		// 指明邮件的收件人</div><div class="line">		message.setRecipient(Message.RecipientType.TO, new InternetAddress(&quot;1811560185@qq.com&quot;));</div><div class="line">		// 邮件的标题</div><div class="line">		message.setSubject(&quot;JavaMail第4次测试&quot;);</div><div class="line">		// 邮件的文本内容</div><div class="line">		message.setContent(&quot;&lt;h1&gt;Java测试发送邮件成功&lt;/h1&gt;&quot;,&quot;text/html;charset=UTF-8&quot;);</div><div class="line">		// 发送邮件</div><div class="line">		transport.sendMessage(message, message.getAllRecipients());</div><div class="line">		transport.close();</div><div class="line">		</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>当报 unkown host smtp.qq.com 时<br>可以在cmd ping smtp.qq.com ，看网络是否联通<br>参考链接<a href="http://www.cnblogs.com/xyzq/p/5704358.html" target="_blank" rel="external">[参考1]<br><a href="http://www.codes51.com/itwd/2880376.html" target="_blank" rel="external">[参考二]</a></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/31/javamail发送邮件/" data-id="cje9wqiyu000jpsvdaa8t1qqu" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java注解" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/26/java注解/" class="article-date">
  <time datetime="2018-01-26T15:37:19.000Z" itemprop="datePublished">2018-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/26/java注解/">java注解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="Deprecated"><a href="#Deprecated" class="headerlink" title="Deprecated"></a>Deprecated</h3><p>过时的，myeclipse会有划线表名这个过时，<br>可以让myeclipse不警告，在方法前面写上注解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@SuppressWarnings(&quot;deprecation&quot;)</div></pre></td></tr></table></figure></p>
<p>可以标记方法过时使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@Deprecated</div></pre></td></tr></table></figure></p>
<h3 id="override"><a href="#override" class="headerlink" title="override"></a>override</h3><p>使用这个注解标记这个方法是覆盖父类的方法。<br>如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean equals(Object obj) &#123;</div><div class="line">	// TODO Auto-generated method stub</div><div class="line">	return super.equals(obj);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注解可以在java.lang包中可以查看基本的注解，注解其实是一个类，要在源程序应用某个注解，必须先准备好注解类</p>
<p>使用自己的注解<br>自定义的注解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.annotation;</div><div class="line"></div><div class="line">public @interface ItcastAnnotation &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>将这个注解加到一个类上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.annotation;</div><div class="line"></div><div class="line">@ItcastAnnotation</div><div class="line">public class AnnotationTest &#123;</div><div class="line"></div><div class="line"></div><div class="line">	public static void main(String[] args) &#123;</div><div class="line"></div><div class="line">		if(AnnotationTest.class.isAnnotationPresent(ItcastAnnotation.class))&#123;</div><div class="line">			ItcastAnnotation annotation = AnnotationTest.class.getAnnotation(ItcastAnnotation.class);</div><div class="line">			System.out.println(annotation);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>用system.out打印注解，什么都没输出，原因是if条件中为false,<br>还需要在注解类上加一个元注解(修饰注解的注解),<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">public @interface ItcastAnnotation &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>即告诉程序，将ItcastAnnotation这个注解保留到运行时<br>这涉及到注解的生命周期<br>即存在于java源文件中–&gt; class文件中 –&gt; 字节码中<br>对应修饰 RetentionPolicy.SOURCE —&gt; RetentionPolicy.CLASS -&gt; RetentionPolicy.RUNTIME<br>默认自定义的保留到class阶段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">the retention policy defaults to RetentionPolicy.CLASS.</div></pre></td></tr></table></figure></p>
<p>修饰自定义的注解只能用在方法上可以在注解上加一个元注解<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@Target(ElementType.METHOD)</div></pre></td></tr></table></figure></p>
<p>既可以用在方法上也可以用在类上<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</div></pre></td></tr></table></figure></p>
<p>为注解添加属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Retention(RetentionPolicy.RUNTIME)</div><div class="line">@Target(&#123;ElementType.METHOD,ElementType.TYPE&#125;)</div><div class="line">public @interface ItcastAnnotation &#123;</div><div class="line">	String color();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>设置与显示属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@ItcastAnnotation(color=&quot;RED&quot;)</div><div class="line">public class AnnotationTest &#123;</div><div class="line"> static void main(String[] args) &#123;</div><div class="line">		if(AnnotationTest.class.isAnnotationPresent(ItcastAnnotation.class))&#123;</div><div class="line">			ItcastAnnotation annotation = AnnotationTest.class.getAnnotation(ItcastAnnotation.class);</div><div class="line">			System.out.println(annotation.color());</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果只设置value属性的值，可以省略<br>属性名=，直接写值<br>如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@ItcastAnnotation(&quot;method&quot;)</div></pre></td></tr></table></figure></p>
<p>可以设置属性为int[]数组类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">int[] arrayAttr() default &#123;0&#125;;</div></pre></td></tr></table></figure></p>
<p>设置值时<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@ItcastAnnotation(color = &quot;RED&quot;, value = &quot;class&quot;, arrayAttr=&#123;1,1,1&#125;)</div></pre></td></tr></table></figure></p>
<p>若数据属性值只有一个，可以省略大括号<br>如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@ItcastAnnotation(color = &quot;RED&quot;, value = &quot;class&quot;, arrayAttr=1)</div></pre></td></tr></table></figure></p>
<p>更多可以参考<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://docs.oracle.com/javase/specs/</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/26/java注解/" data-id="cje9wqiyz000mpsvdnytms38e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-DButils" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/26/DButils/" class="article-date">
  <time datetime="2018-01-26T11:41:35.000Z" itemprop="datePublished">2018-01-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/26/DButils/">DButils</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="DButils"><a href="#DButils" class="headerlink" title="DButils"></a>DButils</h3><p>commons-dbutils是apache公司的一款开源产品<br>特点：只是对jdbc进行简单封装，学习成本低，简化jdbc代码工作量，不影响程序性能<br>对比hibernate，hibernate本身效率很低，需要进行配置才能高效</p>
<p>使用DButils</p>
<ol>
<li>导包</li>
<li><p>DButils有三个核心部分<br>QueryRunner ——————— 执行sql语句<br>ResultSetHandler ———————— 封装结果集<br>DbUtils ——————– 提供大量静态方法，close操作， commit rollback等事务操作</p>
<p>例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">		//已查询为例</div><div class="line">		//查询account表中姓名为tom的信息</div><div class="line">		String sql = &quot;select * from account where name=?&quot;;</div><div class="line">		</div><div class="line">		//获取QueryRunner对象，使用无参构造</div><div class="line">//		QueryRunner runner = new QueryRunner();</div><div class="line">//		runner.query(DataSourceUtils.getConnnection(),sql, null,&quot;tom&quot;);</div><div class="line">		</div><div class="line">		//获取QueryRunner对象，使用有参构造</div><div class="line">		QueryRunner runner = new QueryRunner(DataSourceUtils.getDataSource());</div><div class="line">		</div><div class="line">		runner.query(sql, new ResultSetHandler&lt;ResultSet&gt;()&#123;</div><div class="line"></div><div class="line">			@Override</div><div class="line">			public ResultSet handle(ResultSet set) throws SQLException &#123;</div><div class="line">				while(set.next())&#123;</div><div class="line">					System.out.print(set.getInt(&quot;id&quot;)+&quot;  &quot;);</div><div class="line">					System.out.print(set.getString(&quot;name&quot;)+&quot;  &quot;);</div><div class="line">					System.out.println(set.getInt(&quot;age&quot;));</div><div class="line">				&#125;</div><div class="line">				return set;</div><div class="line">			&#125;&#125;,&quot;tom&quot;);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>如果用了where条件，在执行query语句时，后面需要加参数<br>当未使用where雕件，在执行query语句时，后面不需要加参数<br>插入例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//插入操作</div><div class="line">@Test</div><div class="line">public void test1() throws SQLException&#123;</div><div class="line">	QueryRunner runner = new QueryRunner(DataSourceUtils.getDataSource());</div><div class="line">	String sql = &quot;insert into account values(null,?,?)&quot;;</div><div class="line">	runner.update(sql,&quot;james&quot;,32);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Dbutils使用"><a href="#Dbutils使用" class="headerlink" title="Dbutils使用"></a>Dbutils使用</h4><p>QueryRunner的获取</p>
<ol>
<li>new QueryRunner()<br>事务需要手动管理，使用batch,query,update方法，需要指定Connection参数</li>
<li>new QueryRunner(DataSource ds)<br>事务自动管理，使用batch,query,update方法，不需要指定Connection参数<h3 id="使用DButils进行CRUD操作"><a href="#使用DButils进行CRUD操作" class="headerlink" title="使用DButils进行CRUD操作"></a>使用DButils进行CRUD操作</h3></li>
<li>new QueryRunner(DataSource ds)使用该构造方法时，insert,update,delete操作时，DButils会自动创建Connection,Statement(PreparedStatement)对象。当使用完后，会自动关闭。</li>
<li>new QueryRunner()使用无参构造方法时，将Connection传递给底层的引用，获取Connection,Statement(PreparedStatement)对象，但不会关闭Connection对象，或关闭Statement对象等。<br>runner.update(sql,”glbb”,20);是有返回值的，int 类型，为0代表失败，非零代表成功<br>例子<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">	//insert完成</div><div class="line">	@Test</div><div class="line">	public void update() throws SQLException&#123;</div><div class="line">		//获取QueryRunner对象</div><div class="line">		QueryRunner runner = new QueryRunner(DataSourceUtils.getDataSource());</div><div class="line">		//执行sql</div><div class="line">		String sql = &quot;insert into account values(null,?,?)&quot;;</div><div class="line">		//sql语句无参数</div><div class="line">//		runner.update(sql);</div><div class="line">		//sql语句有参数</div><div class="line">		runner.update(sql,&quot;glbb&quot;,20);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	//delete操作</div><div class="line">	@Test</div><div class="line">	public void delete() throws SQLException&#123;</div><div class="line">		QueryRunner runner = new QueryRunner();</div><div class="line">		Connection connection = DataSourceUtils.getConnnection();</div><div class="line">		String sql = &quot;delete from account where age&lt;?&quot;;</div><div class="line">		runner.update(connection,sql,18);</div><div class="line">		DbUtils.close(connection);</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="关于QueryRunner对象的query方法"><a href="#关于QueryRunner对象的query方法" class="headerlink" title="关于QueryRunner对象的query方法"></a>关于QueryRunner对象的query方法</h4><ol>
<li>ResultSetHandler怎样封装结果集<br>在ResultSetHandler有一个handle方法，参数是ResultSet对象，里面封装了sql语句查询的结果，同时也可将resultSet中的结果封装到一个javabean中</li>
<li>query方法返回值是ResultSetHandler&lt;T&gt;中T对象，也是handle方法的返回值<br>例子<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">//query操作</div><div class="line">@Test</div><div class="line">public void query() throws SQLException&#123;</div><div class="line">	QueryRunner runner = new QueryRunner(DataSourceUtils.getDataSource());</div><div class="line">	String sql = &quot;select * from account&quot;;</div><div class="line">	List&lt;Account&gt; list = runner.query(sql, new ResultSetHandler&lt;List&lt;Account&gt;&gt;()&#123;</div><div class="line"></div><div class="line">		@Override</div><div class="line">		public List&lt;Account&gt; handle(ResultSet rs) throws SQLException &#123;</div><div class="line">			List&lt;Account&gt; list = new ArrayList&lt;Account&gt;();</div><div class="line">			while(rs.next())&#123;</div><div class="line">				Account account = new Account();</div><div class="line">				account.setId(rs.getInt(&quot;id&quot;));</div><div class="line">				account.setName(rs.getString(&quot;name&quot;));</div><div class="line">				account.setAge(rs.getInt(&quot;age&quot;));</div><div class="line">				list.add(account);</div><div class="line">			&#125;</div><div class="line">			return list;</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">	</div><div class="line">	for(Account account : list)&#123;</div><div class="line">		System.out.println(account.getId()+&quot;  &quot;+account.getName()+&quot;  &quot;+account.getAge());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="ResultSetHandler的具体实现类"><a href="#ResultSetHandler的具体实现类" class="headerlink" title="ResultSetHandler的具体实现类"></a>ResultSetHandler的具体实现类</h4><ol>
<li>ArrayHandler 将结果集中的第一行记录封装到一个数据中，每个字段值对象数组中的一个元素。</li>
<li>ArrayListHandler 将结果集中每一行记录封装到数组中，将数组在封装到一个list集合中</li>
<li>BeanHandler 将结果集中第一行记录封装到javaBean对象</li>
<li>BeanListHandler 将结果集中每一条记录封装到一个javaBean对象中，将所有javabean对象封装到一个list集合中</li>
<li>ColumnListHandler 对结果集中每一列进行封装，无参构造方法，返回第一列的封装；int类型，返回第几列；String类型，返回指定的列名对应的列。</li>
<li>KeyedHandler 将结果集封装到一个Map集合中，Map集合中key是对应的列，value值又是一个map集合，key对应列，value对应值，如<br>| id | name | age |<br>|—|:—:|—|<br>|1|glbb|20|<br>|2|pony|40|<br>|3|jackma|50|<br>返回的是<br>1——————– {id——–1,name——–glbb,age——–20}<br>2——————– {id——–2,name——–pony,age——–40}<br>3——————– {id——–3,name——–jackma,age——-50}</li>
<li>MapHandler 将结果集中第一条记录封装到一个map集合中，key字段名称，value 字段值</li>
<li>MapListHandler 将结果集中每一条数据封装到一个map集合中，将所有map集合在放入一个list集合中</li>
<li>ScalarHandler 用于处理聚合函数，如select count(*) from account;<br>对应一行一列的数据</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/26/DButils/" data-id="cje9wqixs0002psvdi3xgs7s1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-元数据" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/25/元数据/" class="article-date">
  <time datetime="2018-01-25T12:01:40.000Z" itemprop="datePublished">2018-01-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/25/元数据/">元数据</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h3><p>元数据的作用：指数据库中的表，字段定义信息</p>
<h4 id="DataBaseMetaData-—————-数据库的信息"><a href="#DataBaseMetaData-—————-数据库的信息" class="headerlink" title="DataBaseMetaData ————— 数据库的信息"></a>DataBaseMetaData ————— 数据库的信息</h4><ol>
<li>如何获取DataBaseMetaData 对象<br>通过Connection中的getMetaData方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">DatabaseMetaData	getMetaData()</div><div class="line">Retrieves a DatabaseMetaData object that contains metadata about the database to which this Connection object represents a connection.</div></pre></td></tr></table></figure>
</li>
</ol>
<p>DataBaseMetaData例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">		DatabaseMetaData dbmd = connection.getMetaData();</div><div class="line">		//获取连接的url</div><div class="line">		System.out.println(dbmd.getURL());</div><div class="line">		//获取用户名,驱动信息，数据库名，数据库版本</div><div class="line">		System.out.println(dbmd.getUserName());</div><div class="line">		System.out.println(dbmd.getDriverName());</div><div class="line">		System.out.println(dbmd.getDatabaseProductName());</div><div class="line">		System.out.println(dbmd.getDatabaseProductVersion());</div><div class="line"></div><div class="line">		//获取表的指定主键结果集</div><div class="line">		ResultSet set = dbmd.getPrimaryKeys(null, null, &quot;account&quot;);</div><div class="line">		if(set.next())&#123;</div><div class="line">			System.out.println(set.getString(4));//COLUMN_NAME 获取主键列名称</div><div class="line">			System.out.println(set.getString(6));//PK_NAME 获取主键名称</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="ParameterMetaData"><a href="#ParameterMetaData" class="headerlink" title="ParameterMetaData"></a>ParameterMetaData</h4><p>ParameterMetaData可以获取PreparedStatement中预定义的sql语句相关信息<br>可以在类PreparedStatement中通过getParameterMetaData()得到ParameterMetaData对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ParameterMetaData	getParameterMetaData()</div><div class="line">Retrieves the number, types and properties of this PreparedStatement object&apos;s parameters.</div></pre></td></tr></table></figure></p>
<p>例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">String sql = &quot;insert into account values(null,?)&quot;;</div><div class="line">//常用API</div><div class="line">//获取参数个数</div><div class="line">int count = metaData.getParameterCount();</div><div class="line">System.out.println(count);	</div><div class="line">//获取参数类型，当使用getParameterType(1)这个方法时会抛出java.sql.SQLException异常，需要在url后面添加?generateSimpleParameterMetadata=true</div><div class="line">int type = metaData.getParameterType(1);</div><div class="line">String typeName = metaData.getParameterTypeName(1);</div><div class="line"></div><div class="line">System.out.println(type+&quot; &quot;+typeName);</div></pre></td></tr></table></figure></p>
<p>注意：以下两个方法mysql驱动实现得不好，只会返回varchar类型<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int type = metaData.getParameterType(1);</div><div class="line">String typeName = metaData.getParameterTypeName(1);</div></pre></td></tr></table></figure></p>
<h4 id="ResultSetMetaData"><a href="#ResultSetMetaData" class="headerlink" title="ResultSetMetaData"></a>ResultSetMetaData</h4><p>ResultSetMetaData    用于获取结果集得一些相关信息,可以从ResultSet中getMetaData()方法获取该对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ResultSetMetaData	getMetaData()</div><div class="line">Retrieves the number, types and properties of this ResultSet object&apos;s columns.</div></pre></td></tr></table></figure></p>
<p>例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ResultSetMetaData metaData = set.getMetaData();</div><div class="line"></div><div class="line">//获取resultSet中列的个数</div><div class="line">System.out.println(metaData.getColumnCount());</div><div class="line">//获取ResultSet中列的名称</div><div class="line">System.out.println(metaData.getColumnName(1));</div><div class="line">//获取ResultSet中列的类型</div><div class="line">System.out.println(metaData.getColumnTypeName(1));</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/25/元数据/" data-id="cje9wqizs0019psvd5xxvdqjv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-事务和数据库连接池" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/21/事务和数据库连接池/" class="article-date">
  <time datetime="2018-01-21T12:48:43.000Z" itemprop="datePublished">2018-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/21/事务和数据库连接池/">事务和数据库连接池</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><p>事务是指一组操作，要么全部成功，要么全部不成功<br>产生事务</p>
<ol>
<li>数据库本身是提供事务的</li>
<li>jdbc提供对事务进行处理</li>
</ol>
<h4 id="数据库中事务处理"><a href="#数据库中事务处理" class="headerlink" title="数据库中事务处理"></a>数据库中事务处理</h4><p>mysql事务是自动提交的—默认情况，事务自动提交，一条sql语句就是一个事务<br>oracle事务是需要手动提交的</p>
<p>start transaction — 开启事务<br>rollback — 回滚<br>commit — 提交事务</p>
<p>mysql 设置提交方式<br>可以通过命令<br>show variables like ‘%commit%’； — 可以查看提交方式<br>set autocommit=off/on;   —- 关闭自动提交</p>
<h4 id="jdbc中事务操作"><a href="#jdbc中事务操作" class="headerlink" title="jdbc中事务操作"></a>jdbc中事务操作</h4><p>在connection中提供<br>设置是否自动commit<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">void setAutoCommit(boolean autoCommit) </div><div class="line">Sets this connection&apos;s auto-commit mode to the given state.</div></pre></td></tr></table></figure></p>
<p>设置回滚操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">void	rollback()</div><div class="line">Undoes all changes made in the current transaction and releases any database locks currently held by this Connection object.</div></pre></td></tr></table></figure></p>
<p>设置提交操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">void	commit()</div><div class="line">Makes all changes made since the previous commit/rollback permanent and releases any database locks currently held by this Connection object.</div></pre></td></tr></table></figure></p>
<p>设置回滚的位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Savepoint	setSavepoint()</div><div class="line">Creates an unnamed savepoint in the current transaction and returns the new Savepoint object that represents it.</div></pre></td></tr></table></figure></p>
<p>回滚到指定的位置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">void	rollback(Savepoint savepoint)</div><div class="line">Undoes all changes made after the given Savepoint object was set.</div></pre></td></tr></table></figure></p>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><p>事务的特性</p>
<ol>
<li>原子性（Atomicity）<br>原子性指事务是一个不可分割的事务单位，事务中的操作要么都发生，要么都不发生</li>
<li>一致性（Consistence）<br>事务完整性必须一致</li>
<li>隔离性（Isolation）<br>事务的隔离性是指多个用户并发访问数据库时，一个用户的事务不能被其他用户的事务所干扰，多个并发事务间数据要相互隔离</li>
<li>持久性（Durability）<br>持久性是指一个用户事务一旦提交，那么它对数据库中的改变就是持久性的，就下来就算数据库发生故障，也不该对它有任何影响</li>
</ol>
<h4 id="事务隔离性"><a href="#事务隔离性" class="headerlink" title="事务隔离性"></a>事务隔离性</h4><p>如果不考虑事务的隔离性，将会引发</p>
<ol>
<li>脏读<br>一个事务读取到其他事务没提交的数据</li>
<li>不可重复读<br>在一个事物中读取两（多）次，两（多）次读取到的结果不一样，强调select操作，数据总条数不变</li>
<li>虚读（幻读）<br>两次读取到的数据不一致，强调的是insert操作，数据的总条数发生改变</li>
</ol>
<h4 id="事物的隔离级别"><a href="#事物的隔离级别" class="headerlink" title="事物的隔离级别"></a>事物的隔离级别</h4><p>数据库有四种隔离级别</p>
<ol>
<li>Serializable ——– 可以避免脏读，不可重复读，虚读的情况发生（串行化，锁表）</li>
<li>Repeatable read —- 可以避免脏读，不可重复读的情况发生（可以重复读取表的数据），不能避免虚读</li>
<li>Read commited —–  可以避免脏读的情况发生（读已经提交了的）</li>
<li>Read uncommited —— 最低级别，不能避免以上情况（读取数据会读取到未提交的数据）</li>
</ol>
<p>mysql的默认隔离级别是 Repeatable read 级别</p>
<h4 id="数据库设置隔离级别"><a href="#数据库设置隔离级别" class="headerlink" title="数据库设置隔离级别"></a>数据库设置隔离级别</h4><p>set session transaction isolation level —- 设置事物隔离级别<br>select @@tx_isolation —- 查询当前事物隔离级别<br>设置隔离级别例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set session transaction isolation level Repeatable read</div></pre></td></tr></table></figure></p>
<p>安全性：Serializable &gt; Repeatable read &gt; Read commited &gt; Read uncommited<br>效率：Serializable &lt; Repeatable read &lt; Read commited &lt; Read uncommited</p>
<h3 id="JDBC设置事物的隔离级别"><a href="#JDBC设置事物的隔离级别" class="headerlink" title="JDBC设置事物的隔离级别"></a>JDBC设置事物的隔离级别</h3><p>在Connection中有几个常量，代表数据库的事物隔离级别<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">static int	TRANSACTION_READ_COMMITTED</div><div class="line">A constant indicating that dirty reads are prevented; non-repeatable reads and phantom reads can occur.</div><div class="line">static int	TRANSACTION_READ_UNCOMMITTED</div><div class="line">A constant indicating that dirty reads, non-repeatable reads and phantom reads can occur.</div><div class="line">static int	TRANSACTION_REPEATABLE_READ</div><div class="line">A constant indicating that dirty reads and non-repeatable reads are prevented; phantom reads can occur.</div><div class="line">static int	TRANSACTION_SERIALIZABLE</div><div class="line">A constant indicating that dirty reads, non-repeatable reads and phantom reads are prevented.</div></pre></td></tr></table></figure></p>
<p>可以通过Connection中的方法设置隔离级别<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">void	setTransactionIsolation(int level)</div><div class="line">Attempts to change the transaction isolation level for this Connection object to the one given.</div></pre></td></tr></table></figure></p>
<h3 id="更新丢失解决"><a href="#更新丢失解决" class="headerlink" title="更新丢失解决"></a>更新丢失解决</h3><p>两个或多个事物更新同一行，但这些事务彼此之间都不知道其他事务进行的修改，因此第二个修改覆盖了第一次修改</p>
<p>数据库采取什么方式来解决更新丢失问题？</p>
<ol>
<li>悲观锁（假设永远可能会发生更新丢失）<br>利用数据库内部锁机制（行级别锁）<br>分为<br>读锁（共享锁）lock in share mode 可以在一行添加多个锁<br>写锁（排他锁） for update     只能有一个锁<br>其中update语句默认是排他锁。<br>锁必须在事物中添加 ，若果commit,锁会自动释放</li>
<li>乐观锁（假设永远不会发生更新丢失）<br>添加一个字段的类型是timestamp，这个类型的特点是可以自动更新当执行update,insert语句时<br>首先先查询一次数据 得到 当前的 timestamp类型的值，<br>中间可以进行其他操作<br>在真正更新前，在获得一次timestamp类型的值，如果两次值一样，说明在这段时间没有其他更新操作，所以执行更新<br>如果两次timestamp的值不一样的话，将第二次查询到的timestamp的值当作第一次查询到的timestamp的值，将过程在执行一遍</li>
</ol>
<h3 id="数据库连接池"><a href="#数据库连接池" class="headerlink" title="数据库连接池"></a>数据库连接池</h3><p>连接池：创建多个Connection对象，放入连接池（其实是一个容器）中，当使用时，从连接池取出一个Connection对象，当使用完后，放回连接池中</p>
<p>编写连接池需要实现java.sql.DataSource接口</p>
<p>自定义连接池步骤</p>
<ol>
<li>创建类实现DataSource接口。</li>
<li>重写getConnection方法。</li>
<li>创建一个LinkedList&lt;Connection&gt;集合</li>
<li>在构造方法间添加多个Connection对象。</li>
<li>在getConnection方法中，从集合获取Connection对象返回Connection,并从集合中移除</li>
<li>定义一个closeConn方法中，用户回收使用后的Connection对象。</li>
</ol>
<p>问题：为了不依赖自定义的API，而是直接使用java.sql.*中的API。<br>如，DataSource ds = new 自定义实现的类();<br>当使用ds.closeConn方法时报错</p>
<p>分析：原来Connection的close方法是销毁Connection对象，而不是将对象放在连接池中，<br>解决方案：</p>
<ol>
<li>重写。</li>
<li>装饰模式<br>装饰模式的特点：在装饰类中定义被装饰的对象，通过构造方法接受装饰对象，装饰类与被装饰的一般会实现同一个接口，或继承同一个类</li>
<li>动态代理<br>要求：jdk提供的动态代理，要求被代理对象必需实现接口,代理对象. java.lang.reflect.Proxy</li>
</ol>
<p>可以动态产生一个类的代理对象，我们可以在其中对某些要执行的内容进行控制。<br>例如：我们现在要做的事情是当Connection执行close方法时，将Connection对象放回连接池中。<br>当close方法执行时，我们可以屏蔽掉原来的执行内容，而是执行我们自己的内容，这样可以达到目的。</p>
<h3 id="DBCP数据库连接池"><a href="#DBCP数据库连接池" class="headerlink" title="DBCP数据库连接池"></a>DBCP数据库连接池</h3><p>DBCP是Apache软件基金组织开发的，需要添加两个jar文件</p>
<ol>
<li>Commons-dbcp.jar  ——- 连接池的实现</li>
<li>Commons-pool.jar  ———— 连接池实现的依赖库<br>以上两个jar包我用的是for java7的，还需添加logging.jar包<br>要使用dbcp有两种方法，需要配置url,password,username,Driver</li>
<li><p>手动配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">BasicDataSource basicDataSource = new BasicDataSource();</div><div class="line">basicDataSource.setDriverClassName(&quot;com.mysql.jdbc.Driver&quot;);</div><div class="line">basicDataSource.setUrl(&quot;jdbc:mysql:///day12?useSSL=false&quot;);</div><div class="line">basicDataSource.setUsername(&quot;root&quot;);</div><div class="line">basicDataSource.setPassword(&quot;gl986144668&quot;);</div><div class="line"></div><div class="line">Connection connection = basicDataSource.getConnection();</div></pre></td></tr></table></figure>
</li>
<li><p>加载配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Properties property = new Properties();</div><div class="line">InputStream inStream = Demo1.class.getClassLoader().getResourceAsStream(&quot;dbcp.properties&quot;);</div><div class="line">property.load(inStream);</div><div class="line">BasicDataSource basicDataSource = BasicDataSourceFactory.createDataSource(property);</div></pre></td></tr></table></figure>
</li>
</ol>
<p>其中配置文件中的配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">driverClassName=com.mysql.jdbc.Driver</div><div class="line">url=jdbc\:mysql\:///day12?useSSL\=false</div><div class="line">username=root</div><div class="line">password=gl986144668</div></pre></td></tr></table></figure></p>
<h3 id="c3p0数据库连接池"><a href="#c3p0数据库连接池" class="headerlink" title="c3p0数据库连接池"></a>c3p0数据库连接池</h3><p>其中需要添加两个jar文件</p>
<ol>
<li>c3p0-0.9.5.2.jar</li>
<li>mchange-commons-java-0.2.11.jar<br>若不添加第二个，将会报错<br>通过这句java.lang.ClassNotFoundException: com.mchange.v2.ser.Indirector 发现缺少jar包</li>
</ol>
<p>可以阅读c3p0的doc文件下的文档</p>
<p>c3p0的手动配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">ComboPooledDataSource comboPooledDataSource = new ComboPooledDataSource();</div><div class="line">comboPooledDataSource.setDriverClass(&quot;com.mysql.jdbc.Driver&quot;);</div><div class="line">comboPooledDataSource.setJdbcUrl(&quot;jdbc:mysql:///day12&quot;);</div><div class="line">comboPooledDataSource.setUser(&quot;root&quot;);</div><div class="line">comboPooledDataSource.setPassword(&quot;gl986144668&quot;);</div><div class="line"></div><div class="line">Connection connection = comboPooledDataSource.getConnection();</div></pre></td></tr></table></figure></p>
<p>c3p0的自动配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line">&lt;c3p0-config&gt;</div><div class="line">  &lt;default-config&gt;</div><div class="line">    &lt;property name=&quot;driverClass&quot;&gt;com.mysql.jdbc.Driver&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;jdbcUrl&quot;&gt;jdbc:mysql:///day12&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;user&quot;&gt;root&lt;/property&gt;</div><div class="line">    &lt;property name=&quot;password&quot;&gt;gl986144668&lt;/property&gt;</div><div class="line"></div><div class="line">  &lt;/default-config&gt;</div><div class="line">&lt;/c3p0-config&gt;</div></pre></td></tr></table></figure></p>
<h3 id="Tomcat服务器管理连接池"><a href="#Tomcat服务器管理连接池" class="headerlink" title="Tomcat服务器管理连接池"></a>Tomcat服务器管理连接池</h3><p>将连接池交给WEB服务器管理 ———- web应用<br>WEB应用如何获得连接对象<br>通过JDNI技术获取连接池对象</p>
<p>tomcat 服务器配置数据源<br>在tomcat/conf目录下有context.xml文件，可以在这个文件中配置，但这个是为所有web应用配置。想要为一个WEB应用配置，可以在WEB应用下的META-INF目录下，新建一个context.xml文件，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;Context&gt;</div><div class="line">	&lt;Resource name=&quot;jdbc/datasource&quot; auth=&quot;Container&quot;</div><div class="line">				type=&quot;javax.sql.DataSource&quot; username=&quot;root&quot;</div><div class="line">				password=&quot;***&quot; driverClassName=&quot;com.mysql.jdbc.Driver&quot;</div><div class="line">				url=&quot;jdbc:mysql://localhost:3306/day12&quot; maxActive=&quot;8&quot; </div><div class="line">				maxIdle=&quot;4&quot; /&gt;</div><div class="line">&lt;/Context&gt;</div></pre></td></tr></table></figure></p>
<p>其中这种配置需要将mysql的驱动程序拷贝到tomcat/lib目录下<br>新建一个servlet<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123;</div><div class="line">	try &#123;</div><div class="line">		Context initcontext = new InitialContext();</div><div class="line">		Context envContext = (Context) initcontext.lookup(&quot;java:comp/env&quot;);</div><div class="line">		DataSource datasource = (DataSource) envContext.lookup(&quot;jdbc/datasource&quot;);</div><div class="line">		</div><div class="line">		Connection connection = datasource.getConnection();</div><div class="line">		Statement statement = connection.createStatement();</div><div class="line">		ResultSet set = statement.executeQuery(&quot;select * from account&quot;);</div><div class="line">		while (set.next()) &#123;</div><div class="line">			System.out.println(set.getString(&quot;name&quot;));</div><div class="line">		&#125;</div><div class="line">		connection.close();</div><div class="line">	&#125; catch (NamingException e) &#123;</div><div class="line">		// TODO Auto-generated catch block</div><div class="line">		e.printStackTrace();</div><div class="line">	&#125; catch (SQLException e) &#123;</div><div class="line">		// TODO Auto-generated catch block</div><div class="line">		e.printStackTrace();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/21/事务和数据库连接池/" data-id="cje9wqizo0015psvdsjbefffe" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JDBC及待解决的编码问题" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/21/JDBC及待解决的编码问题/" class="article-date">
  <time datetime="2018-01-21T06:25:23.000Z" itemprop="datePublished">2018-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/21/JDBC及待解决的编码问题/">JDBC及待解决编码问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>jdbc例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.jdbc;</div><div class="line"></div><div class="line">import java.sql.Connection;</div><div class="line">import java.sql.DriverManager;</div><div class="line">import java.sql.ResultSet;</div><div class="line">import java.sql.SQLException;</div><div class="line">import java.sql.Statement;</div><div class="line"></div><div class="line">import com.mysql.jdbc.Driver;</div><div class="line"></div><div class="line">//JDBC体验</div><div class="line">public class Demo1 &#123;</div><div class="line">	public static void main(String[] args) throws SQLException &#123;</div><div class="line">		//1.驱动管理器注册驱动</div><div class="line">		DriverManager.registerDriver(new Driver());</div><div class="line">		//2.获取连接对象</div><div class="line">		Connection connection = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/day11?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&quot;,&quot;root&quot;,&quot;123456&quot;);</div><div class="line">		//3.获取操作sql语句的对象</div><div class="line">		Statement statement = connection.createStatement();</div><div class="line">		String sql = &quot;select * from user&quot;;</div><div class="line">		//4.根据查询语句得到结果集</div><div class="line">		ResultSet set = statement.executeQuery(sql);</div><div class="line">		while(set.next())&#123;</div><div class="line">			int id = set.getInt(&quot;id&quot;);</div><div class="line">			String username = set.getString(&quot;username&quot;);</div><div class="line">			String password = set.getString(&quot;password&quot;);</div><div class="line">			String email = set.getString(&quot;email&quot;);</div><div class="line">			System.out.println(id+&quot; &quot;+username +&quot; &quot;+password+&quot; &quot;+email);</div><div class="line">		&#125;</div><div class="line">		//5.释放资源</div><div class="line">		set.close();</div><div class="line">		statement.close();</div><div class="line">		connection.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="DriverManager解析"><a href="#DriverManager解析" class="headerlink" title="DriverManager解析"></a>DriverManager解析</h3><p>其中DriverManager是一个容器，可以注册多个数据库驱动在DriverManager中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//1.驱动管理器注册驱动</div><div class="line">DriverManager.registerDriver(new Driver());</div></pre></td></tr></table></figure></p>
<p>其中注册时采用这种方式，会加载两个驱动Driver，其中new 了一个，和类加载时创建了一个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">static &#123;</div><div class="line">    try &#123;</div><div class="line">        java.sql.DriverManager.registerDriver(new Driver());</div><div class="line">    &#125; catch (SQLException E) &#123;</div><div class="line">        throw new RuntimeException(&quot;Can&apos;t register driver!&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>所以这就浪费了空间<br>改进方法<br>采用反射，用类加载器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//1.2通过类加载器注册驱动</div><div class="line">Class.forName(&quot;com.mysql.jdbc.Driver&quot;);</div></pre></td></tr></table></figure></p>
<p>通过类加载器加载，两个好处</p>
<ol>
<li>只产生一个驱动对象</li>
<li>不会依赖具体的mysql API,可维护性更好</li>
</ol>
<p>可以将其中的url，和类加载所在地址可以写到一个配置文件中，可以通过<br>ResourceBundle.getBunder(“db”).getString(“driver”);<br>方法读取，也可以通过类加载器读取<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// 通过读取资源文件获取配置信息</div><div class="line">InputStream is = Demo1.class.getClassLoader().getResourceAsStream(&quot;db.properties&quot;);</div><div class="line">Properties properties = new Properties();</div><div class="line">properties.load(is);</div><div class="line"></div><div class="line">String class_load = properties.getProperty(&quot;class_load&quot;);</div><div class="line">String url = properties.getProperty(&quot;url&quot;);</div><div class="line">String user = properties.getProperty(&quot;user&quot;);</div><div class="line">String password = properties.getProperty(&quot;password&quot;);</div></pre></td></tr></table></figure></p>
<h3 id="url"><a href="#url" class="headerlink" title="url"></a>url</h3><p>其中关于url的简写<br>如果连接的是本机，和端口号也是默认的3306，那么可以省略主机和端口号,即<br>jdbc:mysql:///day11;</p>
<p>其中url由几部分组成<br>jdbc 主协议<br>mysql 副协议<br>localhost 主机地址<br>3306 端口号<br>day11 数据库名</p>
<p>其中url还可以带一些参数过去‘<br>如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jdbc:mysql://localhost:3306/day11?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</div></pre></td></tr></table></figure></p>
<h3 id="Collection对象"><a href="#Collection对象" class="headerlink" title="Collection对象"></a>Collection对象</h3><p>···<br>        Connection connection = DriverManager.getConnection(“jdbc:mysql://localhost:3306/day11?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false”,”root”,”123456”);<br>···<br>其中方法返回的是jar里的com.mysql.jdbc.Connection对象，当我们使用的引用对象是<br>import java.sql.Connection，原因是解耦，不依赖具体api，增加代码可维护性<br>其中collection常用方法<br>createStatement 获取Statement对象<br>prepareStatement 获取preparedStatement对象<br>prepareCall 获取prepareCall对象（可以执行存储过程）<br>与事务处理有关的方法<br>setAutoCommit(boolean f) 设置事物是否自动提交<br>rollback 事物回滚<br>commit 事物提交</p>
<h3 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h3><p>常用方法<br>excuteQuery 执行select语句<br>excuteUpdate 执行update,delete,insert语句<br>excute 执行任意语句<br>addBatch 添加批处理语句<br>excuteBatch 批处理</p>
<h3 id="结果集"><a href="#结果集" class="headerlink" title="结果集"></a>结果集</h3><p>ResultSet 默认是只读，不能修改回数据库的<br>其中ResultSet 中有几个常量的含义</p>
<p>可以选择返回的结果集类型，可以在创建Statement语句时，可以设置返回哪些参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Statement	createStatement(int resultSetType, int resultSetConcurrency)</div><div class="line">Creates a Statement object that will generate ResultSet objects with the given type and concurrency.</div></pre></td></tr></table></figure></p>
<p>结果集类型<br>ResultSet.TYPE_FORWARD_ONLY 设置结果集只能向前<br>ResultSet.TYPE_SCROLL_INSENSITIVE 支持结果集向回滚动，不能查看修改结构<br>ResultSet.TYPE_SCROLL_SENSITIVE 支持结果集向回滚动，查看修改结果</p>
<p>结果集并发策略<br>ResultSet.CONCUR_READ_ONLY 只读<br>ResultSet.CONCUR_UPDATABLE 支持修改</p>
<p>常见三种组合<br>ResultSet.TYPE_FORWARD_ONLY 和 ResultSet.CONCUR_READ_ONLY 默认，只读不支持向回滚动<br>ResultSet.TYPE_SCROLL_INSENSITIVE 和 ResultSet.CONCUR_READ_ONLY 只读，支持向回滚动<br>ResultSet.TYPE_SCROLL_SENSITIVE 和 ResultSet.CONCUR_UPDATABLE 支持向回滚动，同时可以修改写回给数据库</p>
<p>常用API<br>next 光标向下移动<br>previous 移动到前一行<br>absoulute 移动到指定的某一行<br>beforeFirst 移动到最前面<br>afterLast 移动到ResultSet最后面<br>updateRow 更新整行数据</p>
<p>例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.jdbc;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line">import java.io.InputStream;</div><div class="line">import java.sql.Connection;</div><div class="line">import java.sql.DriverManager;</div><div class="line">import java.sql.ResultSet;</div><div class="line">import java.sql.SQLException;</div><div class="line">import java.sql.Statement;</div><div class="line">import java.util.Properties;</div><div class="line"></div><div class="line">public class Demo3 &#123;</div><div class="line">	private static String driver;</div><div class="line">	private static String url;</div><div class="line">	private static String user;</div><div class="line">	private static String password;</div><div class="line">	</div><div class="line">	public static void main(String[] args) throws IOException, ClassNotFoundException, SQLException &#123;</div><div class="line">		// 通过读取资源文件获取配置信息</div><div class="line">		InputStream is = Demo1.class.getClassLoader().getResourceAsStream(&quot;db.properties&quot;);</div><div class="line">		Properties properties = new Properties();</div><div class="line">		properties.load(is);</div><div class="line">		</div><div class="line">		driver = properties.getProperty(&quot;class_load&quot;);</div><div class="line">		url = properties.getProperty(&quot;url&quot;);</div><div class="line">		user = properties.getProperty(&quot;user&quot;);</div><div class="line">	    password = properties.getProperty(&quot;password&quot;);</div><div class="line">	    </div><div class="line">		Class.forName(driver);</div><div class="line">		Connection connection = DriverManager.getConnection(url, user, password);</div><div class="line">		Statement statement = connection.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_UPDATABLE);</div><div class="line">		</div><div class="line">		String sql = &quot;select * from user&quot;;</div><div class="line">		ResultSet resultSet = statement.executeQuery(sql);</div><div class="line">		</div><div class="line">		//遍历集合</div><div class="line">		ergolic(resultSet);</div><div class="line">		</div><div class="line">		resultSet.beforeFirst();</div><div class="line">		resultSet.next();</div><div class="line">		resultSet.updateString(4, &quot;glbb@qq.com&quot;);</div><div class="line">		</div><div class="line">		resultSet.updateRow();</div><div class="line">		//遍历集合</div><div class="line">		resultSet.beforeFirst();</div><div class="line">		ergolic(resultSet);</div><div class="line">		</div><div class="line">		connection.close();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	private static void ergolic(ResultSet resultSet)&#123;</div><div class="line">		try&#123;</div><div class="line">			while(resultSet.next())&#123;</div><div class="line">				int id = resultSet.getInt(&quot;id&quot;);</div><div class="line">				String username = resultSet.getString(&quot;username&quot;);</div><div class="line">				String password = resultSet.getString(&quot;password&quot;);</div><div class="line">				String email = resultSet.getString(&quot;email&quot;);</div><div class="line">				System.out.println(id+&quot; &quot;+username+&quot; &quot;+password+&quot; &quot;+email);</div><div class="line">			&#125;</div><div class="line">		&#125;catch(Exception e)&#123;</div><div class="line">			throw new RuntimeException(e);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>执行后得到的结果<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">1 glbb 123456 986144668@qq.com</div><div class="line">2 pony 123456 pony@qq.com</div><div class="line">3 jackma 123456 jackma@qq.com</div><div class="line">1 glbb 123456 glbb@qq.com</div><div class="line">2 pony 123456 pony@qq.com</div><div class="line">3 jackma 123456 jackma@qq.com</div></pre></td></tr></table></figure></p>
<p>数据库结果和表结果都更新了</p>
<h3 id="PreparedStatement"><a href="#PreparedStatement" class="headerlink" title="PreparedStatement"></a>PreparedStatement</h3><p>使用preparedStatement的好处</p>
<ol>
<li>可以解决sql注入问题</li>
<li>不用在拼接字符串</li>
</ol>
<p>PreparedStatement如何使用</p>
<ol>
<li><p>PreparedStatement 的获取<br>PreparedStatement ps = connection.preparedStatement(String sql）语句<br>其中语句实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String sql = &quot;select * from user where username=? and password=?&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>怎样执行sql语句<br>ResultSet rs = ps.executeQuery()  执行select<br>int row = ps.executeUpdate()   执行insert delete update</p>
</li>
<li>怎样对sql语句进行赋值<br>setXXX方法 如：<br>setInt(站位符索引,值);<br>setString(站位符索引,值);</li>
</ol>
<h3 id="大文本"><a href="#大文本" class="headerlink" title="大文本"></a>大文本</h3><p>写文本到数据库,再从数据库中读出文本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.jdbc;</div><div class="line"></div><div class="line">import java.io.FileReader;</div><div class="line">import java.io.FileWriter;</div><div class="line">import java.io.IOException;</div><div class="line">import java.io.InputStream;</div><div class="line">import java.io.OutputStreamWriter;</div><div class="line">import java.io.Reader;</div><div class="line">import java.sql.Connection;</div><div class="line">import java.sql.DriverManager;</div><div class="line">import java.sql.PreparedStatement;</div><div class="line">import java.sql.ResultSet;</div><div class="line">import java.sql.SQLException;</div><div class="line">import java.util.Properties;</div><div class="line"></div><div class="line">import org.junit.Test;</div><div class="line"></div><div class="line"></div><div class="line">public class TextDemo &#123;</div><div class="line">	private static String driver;</div><div class="line">	private static String url;</div><div class="line">	private static String user;</div><div class="line">	private static String password;</div><div class="line"></div><div class="line">	// 存大文本到数据库</div><div class="line">	@Test</div><div class="line">	public void writeText() throws IOException, ClassNotFoundException, SQLException &#123;</div><div class="line">		// 通过读取资源文件获取配置信息</div><div class="line">		InputStream is = Demo1.class.getClassLoader().getResourceAsStream(&quot;db.properties&quot;);</div><div class="line">		Properties properties = new Properties();</div><div class="line">		properties.load(is);</div><div class="line"></div><div class="line">		driver = properties.getProperty(&quot;class_load&quot;);</div><div class="line">		url = properties.getProperty(&quot;url&quot;);</div><div class="line">		user = properties.getProperty(&quot;user&quot;);</div><div class="line">		password = properties.getProperty(&quot;password&quot;);</div><div class="line"></div><div class="line">		Class.forName(driver);</div><div class="line">		Connection connection = DriverManager.getConnection(url, user, password);</div><div class="line">		</div><div class="line">		String sql = &quot;insert into t_text values(1,?)&quot;;</div><div class="line">		PreparedStatement preparedStatement = connection.prepareStatement(sql);</div><div class="line">		Reader reader = new FileReader(&quot;C:/Users/Administrator/Desktop/pac.txt&quot;);</div><div class="line">		preparedStatement.setCharacterStream(1, reader);</div><div class="line">		</div><div class="line">		preparedStatement.executeUpdate();</div><div class="line">		</div><div class="line">		reader.close();</div><div class="line">		preparedStatement.close();</div><div class="line">		connection.close();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	//读大文本出来</div><div class="line">	@Test</div><div class="line">	public void read() throws IOException, ClassNotFoundException, SQLException&#123;</div><div class="line">		// 通过读取资源文件获取配置信息</div><div class="line">		InputStream is = Demo1.class.getClassLoader().getResourceAsStream(&quot;db.properties&quot;);</div><div class="line">		Properties properties = new Properties();</div><div class="line">		properties.load(is);</div><div class="line"></div><div class="line">		driver = properties.getProperty(&quot;class_load&quot;);</div><div class="line">		url = properties.getProperty(&quot;url&quot;);</div><div class="line">		user = properties.getProperty(&quot;user&quot;);</div><div class="line">		password = properties.getProperty(&quot;password&quot;);</div><div class="line"></div><div class="line">		Class.forName(driver);</div><div class="line">		Connection connection = DriverManager.getConnection(url, user, password);</div><div class="line">		</div><div class="line">		String sql = &quot;select content from t_text where id=?&quot;;</div><div class="line">		PreparedStatement preparedStatement = connection.prepareStatement(sql);</div><div class="line">		preparedStatement.setInt(1, 1);</div><div class="line">		ResultSet resultSet = preparedStatement.executeQuery();</div><div class="line">		</div><div class="line">		if(resultSet.next())&#123;</div><div class="line">			Reader reader = resultSet.getCharacterStream(&quot;content&quot;);</div><div class="line">			FileWriter writer = new FileWriter(&quot;C:/Users/Administrator/Desktop/pac_b.txt&quot;);</div><div class="line">			char[] c = new char[1024*10];</div><div class="line">			int c_count = 0;</div><div class="line">			while((c_count=reader.read(c))!=-1)&#123;</div><div class="line">				writer.write(c,0,c_count);</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			writer.close();</div><div class="line">			reader.close();</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		resultSet.close();</div><div class="line">		preparedStatement.close();</div><div class="line">		connection.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="这个问题待解决"><a href="#这个问题待解决" class="headerlink" title="这个问题待解决"></a>这个问题待解决</h1><p>其中注意：<br>若读取的文本是用utf-8编码保存的，但是写文本是用FileWriter写的，写出来的不是utf-8，所以在开头将会产生乱码，所以注意读写文本编码的一致性,其中还涉及到数据库数据编码问题<br>所以把物理存在的文本保存为ANSI格式，写文本也这样写没有乱码<br>若用utf-8写还是会有乱码,以下是用utf-8写，读取的文本是用utf-8编码保存的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">	//以utf-8写文本</div><div class="line">	FileOutputStream fos = new FileOutputStream(&quot;C:/Users/Administrator/Desktop/pac_b.txt&quot;);</div><div class="line">	OutputStreamWriter osw = new OutputStreamWriter(fos,&quot;UTF-8&quot;);</div><div class="line">	char[] c = new char[1024*10];</div><div class="line">	int c_count = 0;</div><div class="line">	while((c_count=reader.read(c))!=-1)&#123;</div><div class="line">		osw.write(c,0,c_count);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	osw.close();</div><div class="line">	reader.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="预处理"><a href="#预处理" class="headerlink" title="预处理"></a>预处理</h3><p>预处理的两种方式</p>
<ol>
<li>Statement<br>addBatch(String sql)  添加sql语句到待执行的列表中<br>clearBatch() 清空所有sql<br>executeBatch() 执行列表中有的sql语句</li>
<li>PreparedStatement<br>addBatch() 添加sql语句到批处理中<br>executeBatch() 批量执行sql语句</li>
</ol>
<p>Statement和PreparedStatement语句批量执行的区别</p>
<ol>
<li>statement适合批量执行不同类型的sql语句，PreparedStatement适合批量执行相似的sql语句</li>
<li>statement的效率低于PreparedStatement的批量执行效率</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/21/JDBC及待解决的编码问题/" data-id="cje9wqiy10006psvd0r9fomro" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mysql在windows下的入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/19/mysql在windows下的入门/" class="article-date">
  <time datetime="2018-01-19T03:06:30.000Z" itemprop="datePublished">2018-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/19/mysql在windows下的入门/">mysql在windows下的入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="mysql卸载"><a href="#mysql卸载" class="headerlink" title="mysql卸载"></a>mysql卸载</h3><ol>
<li>查找数据文件的位置<br> 因为数据文件可能和安装文件不在一个位置，删除安装文件后，不会将数据文件删除，所以可以找到my.ini配置文件，找到文件中的datadir项，记住数据文件的地址，可以选择是否删除数据文件</li>
<li>之后正常删除数据库就可以了</li>
<li>在以前的安装目录下可能有一些遗留文件，可以删除</li>
</ol>
<h3 id="mysql安装需要注意的问题"><a href="#mysql安装需要注意的问题" class="headerlink" title="mysql安装需要注意的问题"></a>mysql安装需要注意的问题</h3><ol>
<li>配置mysql的字符集，默认initial为ISO8859-1改为utf-8</li>
<li>配置环境变量，为了能在命令行cmd进入mysql，需要将mysql下的bin目录加入环境变量path</li>
</ol>
<h3 id="mysql重置root密码"><a href="#mysql重置root密码" class="headerlink" title="mysql重置root密码"></a>mysql重置root密码</h3><ol>
<li>停止mysql服务器，运行输入services.msc，停止mysql服务</li>
<li>在cmd下，输入mysql –skip-grant-tables启动服务器，这时cmd光标不动</li>
<li>在新打开一个cmd输入mysql -u root -p 不需要密码，回车进入mysql,输入<br>use mysql;<br>update user set password=password(‘abc’) where user=’root’;<br>其中abc为设置的密码</li>
<li>然后结束mysqld服务，可以在任务管理器中进程结束mysqld进程</li>
<li>启动mysql服务器</li>
</ol>
<h3 id="mysql数据服务器的登陆"><a href="#mysql数据服务器的登陆" class="headerlink" title="mysql数据服务器的登陆"></a>mysql数据服务器的登陆</h3><p>查看mysql帮助，可以在cmd输入<br>mysql -?<br>其他的登陆方式<br>mysql -h 主机名 -P 端口 -u 用户名 -p 密码<br>如果在本机上安装了mysql<br>则可省略主机名和端口号</p>
<h3 id="SQL语言"><a href="#SQL语言" class="headerlink" title="SQL语言"></a>SQL语言</h3><p>SQL== Struct Query Luanguage ,结构化查询语言<br>SQL是非过程性语言<br>各个sql语言没有关系</p>
<h4 id="sql分类"><a href="#sql分类" class="headerlink" title="sql分类"></a>sql分类</h4><table>
<thead>
<tr>
<th>DDL</th>
<th style="text-align:left">数据定义语言</th>
<th>用来定义数据库和表等</th>
</tr>
</thead>
<tbody>
<tr>
<td>DML</td>
<td style="text-align:left">数据操纵语言</td>
<td>update insert delete</td>
</tr>
<tr>
<td>DCL</td>
<td style="text-align:left">数据控制语言</td>
<td>用户权限事物处理</td>
</tr>
<tr>
<td>DQL</td>
<td style="text-align:left">数据查询语言</td>
<td>select</td>
</tr>
</tbody>
</table>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><ol>
<li>创建数据库<br>create database 数据库名;<br>创建数据库时可以指定编码集和校验规则<br> character set：指定数据库中采用的字符集<br>collate:指定数据库字符集的比较方式<br>create database 数据库名 character set=”utf8” collate=”utf8_general_ci”;</li>
<li>使用数据库<br>use 数据库名称</li>
<li>删除数据库<br>drop database 数据库名</li>
<li>查看有哪些数据库<br>show databases;</li>
<li>修改数据库<br>alter database 数据库名 character set=”编码集” collate=”校验”</li>
<li>查看当前使用的数据库<br>select database();</li>
<li>查看数据库的定义信息如字符集等<br>show create database 数据库名;</li>
</ol>
<h3 id="数据表（table）"><a href="#数据表（table）" class="headerlink" title="数据表（table）"></a>数据表（table）</h3><ol>
<li>简单创建<br>create table 表名(<pre><code>字段名称1 类型，
字段名称2 类型，
.......
</code></pre>)</li>
<li>指定表的编码与创建<br>create table 表名(<pre><code>字段名称1 类型，
字段名称2 类型，
.......
</code></pre>) character set=编码 collate=校验、<h3 id="数据表中的类型"><a href="#数据表中的类型" class="headerlink" title="数据表中的类型"></a>数据表中的类型</h3>与java类型相比<br>java类型对应的mysql类型<br>java  整形<br>byte short int long<br>mysql中<br>tinyint smallint int bigint<br>java中的boolean类型对应mysql中的boolean类型<br>java中的字符串在mysql中表示为varchar或char<br>varchar表示可变长的字符串<br>char表示不变长的字符串<br>varchar与char相比节约空间但效率比char低<br>java中的日期<br>java.util.Date<br>java.sql.Date<br>java.sql.Time<br>java.sql.Timestanp<br>mysql中对应的日期<br>date ———————– 2011-09-03<br>datetime——————-2011-09-03 11:11:11<br>time ————————11:11:11<br>timestamp—————–对应的毫秒值<br>java中小数<br>float double<br>mysql中小数<br>float double<br>mysql中decimal也可以表示小数<br>decimal(5,2)<br>表示这个数包含整数和小数最多五位，小数为两位</li>
</ol>
<p>java中<br>InputStream/OutputStream对应mysql中的blob<br>Reader/Writer对应mysql中的text</p>
<h3 id="查看表"><a href="#查看表" class="headerlink" title="查看表"></a>查看表</h3><p>查看当前数据库下的所有表<br>show tables;<br>查看创建表的sql语句<br>show create table 表名;<br>查看表的约束<br>desc 表名;</p>
<h3 id="表约束"><a href="#表约束" class="headerlink" title="表约束"></a>表约束</h3><p>保证数据的有效性和完整性</p>
<ol>
<li>主键约束<br>非空 唯一</li>
<li>非空约束</li>
<li>唯一约束</li>
<li>外键约束<br>例子<br>create table 表名(<br> id int primary key auto_increment,<br> eid varchar(30) not null unique,<br> name varchar(10),<br> gender varchar(5),<br> birthday date,<br> entrydate datetime,<br> job varchar(20)<br> salary decimal(8,2),<br> resume longtext<br>)charset set=”utf8” collate=”utf8_general_ci”;<br>其中关键字auto_increment设置主键自动增长，每加入一个记录增加一次</li>
</ol>
<h3 id="表结构的修改"><a href="#表结构的修改" class="headerlink" title="表结构的修改"></a>表结构的修改</h3><p>结合例子<br>创建一个users表</p>
<p>create table users(<br>    id int,<br>    name varchar(20)<br>);</p>
<ol>
<li>添加字段<br>alter table 表名 add 字段 类型<br>alter table users add birthday date;</li>
<li>修改字段类型<br>alter table 表名 modify 字段 类型<br>alter table users modify birthday datetime;</li>
<li>删除字段<br>alter table 表名 drop 字段<br>alter table users drop birthday;</li>
<li>修改字段名称<br>alter table 表名 change 旧字段名称 新字段名称 字段类型<br>alter table users change birthday entry_date date;<br>同时change还可以同时修改字段类型和字段名称</li>
<li>修改表所用的字符集<br>alter table 表名 charset set=”utf8”</li>
<li>修改表名<br>rename table 表名 to 新表名</li>
<li>删除主键<br>alter table 表名 drop primary key;<br>其中如果主键具有auto_increment使用如上命令删除不掉</li>
</ol>
<h3 id="操作数据表"><a href="#操作数据表" class="headerlink" title="操作数据表"></a>操作数据表</h3><p>C create insert<br>R read    select<br>U update update<br>D delete delete<br>简单查询<br>select * from 表名; 查看表中所有数据</p>
<ol>
<li>insert 操作<br>基本格式1<br>insert into 表名(字段1,字段2) values(值1,值2);<br>基本格式2<br>如果对所有字段进行插入操作，则可<br>insert into 表名 values(值,..);<br>基本格式3<br>对指定字段添加记录<br>insert into 表名(字段名) values(值1,..)<br>注意事项：<br>其中值只有数值类型可以不加引号，其他都必须用引号引起来<br>插入值类型必须和列类型匹配<br>值长度不能超过列定义长度<br>插入空值可以写null</li>
</ol>
<p>当插入中文报错问题解决<br>mysql有6处采用了字符集<br>client客户端采用的字符集<br>connection是连接数据库字符集类型，如果程序没有指明连接数据库使用的字符集，就采用默认的字符集<br>database是是数据库某个库使用的字符集设定，如果建库没有指明，就采用默认的<br>results是数据库客户端返回结果时采用的字符集设定，没有指明采用默认的<br>server是服务器安装时指定的字符集<br>system是数据库系统采用的字符集</p>
<p>其中client,connection,results与客户端相关</p>
<p>查看mysql所有采用字符集都采用的什么编码<br>show variables like ‘character%’;<br>其中cmd默认采用gbk编码<br>所以可以选择修改mysql客户端编码为gbk<br>set character_set_client=gbk; 是为了输入时编码正确<br>set character_set_results=gbk; 是为了显示时编码正确<br>其中以上两个设置只是临时设置，重启cmd会恢复成原来的<br>永远改变需要修改my.ini配置文件<br>其中my.ini中有<br>在client处有<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">default-character-set=utf8</div></pre></td></tr></table></figure></p>
<p>可修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">default-character-set=gbk</div></pre></td></tr></table></figure></p>
<p>其中client,connection,results都会变成gbk<br>修改配置文件后需要重启mysql服务器</p>
<h3 id="update语句"><a href="#update语句" class="headerlink" title="update语句"></a>update语句</h3><p>基本格式<br>update 表名 set 字段=值<br>一般情况下会加上where条件，如果不加，是对整个字段进行修改<br>update 表名 set 字段=值 where 条件<br>如<br>update users set name=’james’ where id=1;<br>如果修改多个字段<br>update users set 字段1=值,字段2=值,… where 条件<br>其中值可以为一个表达式</p>
<h3 id="delete语句"><a href="#delete语句" class="headerlink" title="delete语句"></a>delete语句</h3><p>delete from 表名 where 条件<br>如果不加条件，相当于删除所有数据</p>
<p>delete只是删除记录，不能删除某一列的值<br>delete只是删除记录，不能删除表结构</p>
<p>delete,truncate,drop区别<br>delete和truncate是删除表中的数据，而drop是删除表结构</p>
<p>delete和truncate的区别</p>
<ol>
<li>delete是一行一行记录的删除<br>而truncate是将表结构删除，在重新创建表结构<br>所以truncate的效率高于delete</li>
<li>delete是受事物控制的<br>truncate是受事物控制的<br>delete记录可以恢复，truncate记录不能恢复</li>
<li>delete可以对指定记录进行删除<br>truncate不可以</li>
</ol>
<p>drop和truncate的语法<br>drop table 表名<br>truncate table 表名</p>
<h3 id="select字段"><a href="#select字段" class="headerlink" title="select字段"></a>select字段</h3><p>语法<br>select 字段1,字段2,… from 表名;<br>可以用distinct删除重复数据<br>select distinct 字段1,字段2,.. from 表名<br>在select中可以对查询的进行运算<br>如 select chinese+english from student;<br>更多参考书籍</p>
<h3 id="数据库的备份与恢复"><a href="#数据库的备份与恢复" class="headerlink" title="数据库的备份与恢复"></a>数据库的备份与恢复</h3><ol>
<li>数据库的备份<br>在数据库外面对数据库进行备份，使用cmd使用如下命令<br>mysqldump -u 用户名 -p 数据库名 &gt; 路径文件名.sql<br>输入密码ok，其中文件名可以带路径</li>
<li>数据库的恢复<br>在mysql内部恢复，必须先创建出数据库，切换数据库，然后使用命令<br>source 路径文件名.sql<br>在外部对数据库进行恢复,必须先创建出数据库,在cmd下<br>mysql -u root -p 数据库名 &lt; 路径文件名.sql</li>
</ol>
<h3 id="多表设计"><a href="#多表设计" class="headerlink" title="多表设计"></a>多表设计</h3><p>一对一的关系，想要关联数据，可以在任何一方，添加对方的关联的信息<br>多对一的关系，想要关联数据，可以在多的一方，添加一的一方的关联信息<br>多对多的关系，想要关联数据，可以产生一张中间表，用来关联多对多关系</p>
<p>外键约束可以保证数据完整性<br>语法<br>dept_id int;<br>forein key emp(dept_id) references dept(id);</p>
<h3 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h3><p>select <em> from 表1,表2;<br>这会产生笛卡尔积，即将表1,表2的数据每一个都组合起来，所以还需要加上条件<br>select </em> from 表1,表2 where 表1.字段=表2.字段;</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/19/mysql在windows下的入门/" data-id="cje9wqiz6000spsvd2otlu1w3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-jsp中自定义标签" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/17/jsp中自定义标签/" class="article-date">
  <time datetime="2018-01-17T14:32:03.000Z" itemprop="datePublished">2018-01-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/17/jsp中自定义标签/">jsp中自定义标签</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="使用自定义标签移除java代码，需完成以下两个步骤："><a href="#使用自定义标签移除java代码，需完成以下两个步骤：" class="headerlink" title="使用自定义标签移除java代码，需完成以下两个步骤："></a>使用自定义标签移除java代码，需完成以下两个步骤：</h3><ol>
<li>编写一个实现Tag接口的Java类，把页面中的Java代码移动到这个类中（标签处理器类）。</li>
<li>编写标签库描述符tld文件，在tld文件中把标签处理器类描述成一个标签</li>
</ol>
<p>例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">你的ip是：</div><div class="line">&lt;%</div><div class="line">	String addr = request.getRemoteAddr();</div><div class="line">	out.print(addr);</div><div class="line">%&gt;</div></pre></td></tr></table></figure></p>
<p>将jsp中的java代码移除<br>新建一个类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.web.tag;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line"></div><div class="line">import javax.servlet.http.HttpServletRequest;</div><div class="line">import javax.servlet.jsp.JspException;</div><div class="line">import javax.servlet.jsp.JspWriter;</div><div class="line">import javax.servlet.jsp.tagext.TagSupport;</div><div class="line"></div><div class="line">public class ViewIpTag extends TagSupport&#123;</div><div class="line"></div><div class="line">	private static final long serialVersionUID = 1L;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public int doStartTag() throws JspException &#123;</div><div class="line">		HttpServletRequest request = (HttpServletRequest) this.pageContext.getRequest();</div><div class="line">		JspWriter out = this.pageContext.getOut();</div><div class="line">		</div><div class="line">		String ip = request.getRemoteAddr();</div><div class="line">		try &#123;</div><div class="line">			out.print(ip);</div><div class="line">		&#125; catch (IOException e) &#123;</div><div class="line">			throw new RuntimeException(e);</div><div class="line">		&#125;</div><div class="line">		return super.doStartTag();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在WEB-INF新建一个tld文件<br>tld文件可以参考tomcat下webapps中examples项目中WEB-INF下jsp2下的一个tld文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</div><div class="line"></div><div class="line">&lt;taglib xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;</div><div class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</div><div class="line">    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-jsptaglibrary_2_0.xsd&quot;</div><div class="line">    version=&quot;2.0&quot;&gt;</div><div class="line">    &lt;description&gt;A tag library exercising SimpleTag handlers.&lt;/description&gt;</div><div class="line">    &lt;tlib-version&gt;1.0&lt;/tlib-version&gt;</div><div class="line">    &lt;short-name&gt;glbb&lt;/short-name&gt;</div><div class="line">    &lt;uri&gt;http://www.glbb.com&lt;/uri&gt;</div><div class="line">    </div><div class="line">    &lt;tag&gt;</div><div class="line">        &lt;name&gt;ViewIp&lt;/name&gt;</div><div class="line">        &lt;tag-class&gt;cn.itcast.web.tag.ViewIpTag&lt;/tag-class&gt;</div><div class="line">        &lt;body-content&gt;empty&lt;/body-content&gt;</div><div class="line">    &lt;/tag&gt;</div><div class="line">&lt;/taglib&gt;</div></pre></td></tr></table></figure></p>
<p>其中uri配置一个地址，short-name配置一个名字<br>在jsp中使用taglib引入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;utf-8&quot;%&gt;</div><div class="line">&lt;%@taglib uri=&quot;http://www.glbb.com&quot; prefix=&quot;itcast&quot;%&gt;</div><div class="line"></div><div class="line">&lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&gt;</div><div class="line">&lt;html&gt;</div><div class="line">  &lt;head&gt;</div><div class="line">    &lt;title&gt;输出客户机的ip&lt;/title&gt;</div><div class="line">  &lt;/head&gt;</div><div class="line">  </div><div class="line">  &lt;body&gt;</div><div class="line">    你的ip是：&lt;itcast:ViewIp/&gt;</div><div class="line">  &lt;/body&gt;</div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure></p>
<p>其中自定义标签的调用原理</p>
<ol>
<li>ie访问web服务器</li>
<li>web服务器连接上对应的jsp</li>
<li>jsp中执行到自定义标签，实例化对应的标签处理器类</li>
<li>调用setPageContext方法，把页面的pageContext对象传递给标签处理器类</li>
<li>看标签是否有父标签，如果有父标签，把父标签作为一个对象，调用setPararent方法传递给标签处理器类，如果没有，传null</li>
<li>完成以上的标签的初始化工作后，服务器就开始执行标签，遇到标签的开始标签，就调用doStartTag方法</li>
<li>如果标签有标签体，服务器一般会执行标签体</li>
<li>服务器遇到jsp标签的结束标签，就调用标签处理器类的doEndTag方法</li>
<li>标签执行完以后，服务器一般会调用release方法，释放标签工作时占用的资源</li>
<li>服务器接着执行jsp余下的页面</li>
</ol>
<h3 id="控制标签体是否输出"><a href="#控制标签体是否输出" class="headerlink" title="控制标签体是否输出"></a>控制标签体是否输出</h3><p>可以查看tag类中doStarTag方法，其中有段描述<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Returns:</div><div class="line">EVAL_BODY_INCLUDE if the tag wants to process body, SKIP_BODY if it does not want to process it.</div></pre></td></tr></table></figure></p>
<h3 id="控制标签后的内容是否还会执行"><a href="#控制标签后的内容是否还会执行" class="headerlink" title="控制标签后的内容是否还会执行"></a>控制标签后的内容是否还会执行</h3><p>可以查看doEndTag方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Returns:</div><div class="line">indication of whether to continue evaluating the JSP page.</div><div class="line"></div><div class="line">If this method returns EVAL_PAGE, the rest of the page continues to be evaluated. If this method returns SKIP_PAGE, the rest of the page is not evaluated,</div></pre></td></tr></table></figure></p>
<h3 id="重复多次执行标签体"><a href="#重复多次执行标签体" class="headerlink" title="重复多次执行标签体"></a>重复多次执行标签体</h3><p>其中Tag接口的一个子接口IterationTag的doAfterBody方法可以控制标签体执行多次<br>可参考doAfterBody介绍<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Returns:</div><div class="line">whether additional evaluations of the body are desired</div><div class="line"></div><div class="line">If doAfterBody returns EVAL_BODY_AGAIN, a new evaluation of the body will happen (followed by another invocation of doAfterBody). If doAfterBody returns SKIP_BODY, no more body evaluations will occur, and the doEndTag method will be invoked.</div></pre></td></tr></table></figure></p>
<p>先控制开始标签执行标签体，在调用doAfterBody方法返回不同的返回值</p>
<h3 id="控制标签体内容大写"><a href="#控制标签体内容大写" class="headerlink" title="控制标签体内容大写"></a>控制标签体内容大写</h3><p>可以查看BodyTag接口中的一个常类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">static int	EVAL_BODY_BUFFERED</div><div class="line">Request the creation of new buffer, a BodyContent on which to evaluate the body of this tag.</div></pre></td></tr></table></figure></p>
<p>可以在doStarTag返回这个返回值，在标签结束doEndTag得到标签体BodyContent对象，通过getString方法得到标签体内容，然后进行处理，然后得到Out对象进行输出</p>
<p>其中实现不同的功能需要实现不同的接口，sun公司觉得不太好，于是开发出SimpleTag接口，一个接口可以实现以上全部功能</p>
<h2 id="使用SimpleTag接口"><a href="#使用SimpleTag接口" class="headerlink" title="使用SimpleTag接口"></a>使用SimpleTag接口</h2><p>可以继承实现类simpleTagSupport类</p>
<h4 id="使用simpletag接口执行标签体"><a href="#使用simpletag接口执行标签体" class="headerlink" title="使用simpletag接口执行标签体"></a>使用simpletag接口执行标签体</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void doTag() throws JspException, IOException &#123;</div><div class="line">	JspFragment fragment = this.getJspBody();</div><div class="line">	fragment.invoke(this.getJspContext().getOut());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>若想不执行标签体，可以在重写的doTag方法不写任何代码即可</p>
<h4 id="使用simpleTag接口执行多次标签体"><a href="#使用simpleTag接口执行多次标签体" class="headerlink" title="使用simpleTag接口执行多次标签体"></a>使用simpleTag接口执行多次标签体</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void doTag() throws JspException, IOException &#123;</div><div class="line">	JspFragment fragment = this.getJspBody();</div><div class="line">	for(int i=0;i&lt;5;i++)&#123;</div><div class="line">		fragment.invoke(null);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中invoke(null)等同于invoke(this.getJspContext().getOut());</p>
<h4 id="修改标签体"><a href="#修改标签体" class="headerlink" title="修改标签体"></a>修改标签体</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void doTag() throws JspException, IOException &#123;</div><div class="line">	JspFragment fragment = this.getJspBody();</div><div class="line">	StringWriter sw = new StringWriter();</div><div class="line">	fragment.invoke(sw);</div><div class="line">	</div><div class="line">	String content = sw.toString();</div><div class="line">	content = content.toUpperCase();</div><div class="line">	this.getJspContext().getOut().write(content);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="控制标签后的jsp内容不执行"><a href="#控制标签后的jsp内容不执行" class="headerlink" title="控制标签后的jsp内容不执行"></a>控制标签后的jsp内容不执行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">SkipPageException - If the page that (either directly or indirectly) invoked this tag is to cease evaluation. A Simple Tag Handler generated from a tag file must throw this exception if an invoked Classic Tag Handler returned SKIP_PAGE or if an invoked Simple Tag Handler threw SkipPageException or if an invoked Jsp Fragment threw a SkipPageException.</div></pre></td></tr></table></figure>
<p>在doTag方法中抛出这个异常，即jsp页面不执行</p>
<h4 id="简单标签执行流程"><a href="#简单标签执行流程" class="headerlink" title="简单标签执行流程"></a>简单标签执行流程</h4><ol>
<li>浏览器连接web服务器</li>
<li>web服务器连接到对应的Jsp文件</li>
<li>执行到jsp中简单标签位置</li>
<li>实例化处理器类</li>
<li>调用servletContext,把页面pageContext对象传递给标签处理器类</li>
<li>调用setParent方法，把父标签传递进去，如果没有父标签，传递Null</li>
<li>调用setJspBody方法，把封装了标签体的JspFragment传递给标签处理器类</li>
<li>执行页面中的自定义标签，实际上就是调用doTag方法</li>
<li>标签执行完毕</li>
</ol>
<h2 id="开发自定义标签带属性"><a href="#开发自定义标签带属性" class="headerlink" title="开发自定义标签带属性"></a>开发自定义标签带属性</h2><p>通常需要两个步骤</p>
<ol>
<li>在标签处理器类中编写每个属性对应的setter方法</li>
<li>在tld文件中描述该属性</li>
</ol>
<p>在自定义标签属性时，每个属性命名方式必须按照javaBean命名方法命名，在标签处理器中定义setter方法，用来接受jsp页面调用自定义标签传递进来的属性值<br>在标签处理器定义setter方法后，jsp引擎在执行开始标签前，也就是调用doStartTag方法前会调用set属性的方法，为标签设置属性<br>例子<br>标签处理器类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">package cn.itcast.web.simpletag;</div><div class="line"></div><div class="line">import java.io.IOException;</div><div class="line"></div><div class="line">import javax.servlet.jsp.JspException;</div><div class="line">import javax.servlet.jsp.tagext.JspFragment;</div><div class="line">import javax.servlet.jsp.tagext.SimpleTagSupport;</div><div class="line"></div><div class="line">public class SimpleTagDemo5 extends SimpleTagSupport&#123;</div><div class="line">	private int count;</div><div class="line">	</div><div class="line">	public void setCount(int count) &#123;</div><div class="line">		this.count = count;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	public void doTag() throws JspException, IOException &#123;</div><div class="line">		JspFragment fragment = this.getJspBody();</div><div class="line">		for(int i=0;i&lt;count;i++)&#123;</div><div class="line">			fragment.invoke(null);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>tld文件中描述属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;tag&gt;</div><div class="line">	&lt;name&gt;demo5&lt;/name&gt;</div><div class="line">	&lt;tag-class&gt;cn.itcast.web.simpletag.SimpleTagDemo5&lt;/tag-class&gt;</div><div class="line">	&lt;body-content&gt;scriptless&lt;/body-content&gt;</div><div class="line">	</div><div class="line">	&lt;attribute&gt;</div><div class="line">		&lt;name&gt;count&lt;/name&gt;</div><div class="line">		&lt;required&gt;true&lt;/required&gt;</div><div class="line">		&lt;rtexprvalue&gt;true&lt;/rtexprvalue&gt;</div><div class="line">	&lt;/attribute&gt;</div><div class="line">&lt;/tag&gt;</div></pre></td></tr></table></figure></p>
<p>其中rtexprvalue描述标签赋值是否允许运行时赋值，即是否可以用脚本表达式或el表达式运行时赋值</p>
<h3 id="自定义标签"><a href="#自定义标签" class="headerlink" title="自定义标签"></a>自定义标签</h3><p>将标签库制作为一个Jar包，像jstl一样，在以后的项目中复用标签</p>
<ol>
<li>新建java工程taproject</li>
<li>在java工程中新建META-INF目录，将编写标签的tld文件，复制到该目录</li>
<li>将标签类复制到工程下src目录中，需要为java工程导入javaee的jar包，可右键工程属性–javabuildpath–liberaries–add liberaries–添加myeclipse liberaries–添加javaee类库</li>
<li>右键工程export导出jar file</li>
</ol>
<h3 id="jstl核心标签库"><a href="#jstl核心标签库" class="headerlink" title="jstl核心标签库"></a>jstl核心标签库</h3><p>可参考菜鸟教程</p>
<h4 id="国际化主要操作"><a href="#国际化主要操作" class="headerlink" title="国际化主要操作"></a>国际化主要操作</h4><ol>
<li>动态信息<br> 时间  货币</li>
<li>静态信息<br> 固定的文本信息</li>
</ol>
<h3 id="固定文本的国际化"><a href="#固定文本的国际化" class="headerlink" title="固定文本的国际化"></a>固定文本的国际化</h3><p>对于固定信息，应该固定在properties文件中，对于不同国家应该有不同的properties文件，这一组properties文件称作资源包<br>properties文件的名称格式<br>        基名_语言_国家.properties<br>        例子<br>        info_zh_CN.properties<br>        info_en_US.properties<br>ResourceBundle可以操作资源包<br>例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ResourceBundle bundle = ResourceBundle.getBundle(&quot;info&quot;,Locale.US);</div><div class="line">String value = bundle.getString(&quot;name&quot;);</div><div class="line">System.out.println(value);</div></pre></td></tr></table></figure></p>
<p>其中资源文件在src目录下<br>基名.properties是默认的基名文件</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/17/jsp中自定义标签/" data-id="cje9wqiz0000npsvd10oqfe45" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-el表达式和jstl快速入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/09/el表达式和jstl快速入门/" class="article-date">
  <time datetime="2018-01-09T11:47:41.000Z" itemprop="datePublished">2018-01-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/09/el表达式和jstl快速入门/">el表达式和jstl快速入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="EL表达式"><a href="#EL表达式" class="headerlink" title="EL表达式"></a>EL表达式</h2><p>el表达式用于获取数据，在jsp页面可使用${标识符}的形式，通知Jsp引擎调用pageContext.findAttribute()方法，以标示符为关键字从各个域对象中获取对象，如何域对象不存在标识符对应的对象，则返回空字符串””(注意，不是null)</p>
<p>获取data属性的值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;% </div><div class="line">	String data = &quot;aaaaaaaaa&quot;;</div><div class="line">	request.setAttribute(&quot;data&quot;, data);</div><div class="line">%&gt;</div><div class="line"></div><div class="line">$&#123;data&#125;  &lt;!-- pageContext.findAttribute()  page request session application --&gt;</div></pre></td></tr></table></figure></p>
<p>获取一个对象的属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;% </div><div class="line">	Person p = new Person();</div><div class="line">	p.setName(&quot;GLBB&quot;);</div><div class="line">	request.setAttribute(&quot;person&quot;, p);</div><div class="line">%&gt;</div><div class="line">$&#123;person.name&#125;</div></pre></td></tr></table></figure></p>
<p>javabean中有对象，获取javabean对象中的值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;% </div><div class="line">	Person p1 = new Person();</div><div class="line">	Address addr = new Address();</div><div class="line">	addr.setCity(&quot;上海&quot;);</div><div class="line">	</div><div class="line">	p1.setAddress(addr);</div><div class="line">	request.setAttribute(&quot;p1&quot;, p1);</div><div class="line">%&gt;</div><div class="line"></div><div class="line">$&#123;p1.address.city&#125;</div></pre></td></tr></table></figure></p>
<p>获取集合中的元素的值<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;% </div><div class="line">	List&lt;Person&gt; list = new ArrayList&lt;&gt;();</div><div class="line">	list.add(new Person(&quot;aaa&quot;));</div><div class="line">	list.add(new Person(&quot;bbb&quot;));</div><div class="line">	list.add(new Person(&quot;ccc&quot;));</div><div class="line">	request.setAttribute(&quot;list&quot;, list);</div><div class="line">%&gt;</div><div class="line">$&#123;list[1].name&#125;</div></pre></td></tr></table></figure></p>
<p>如果想要把list中所有元素迭代出来，需要配合jstl</p>
<p>获取map集合中的数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;% </div><div class="line">	Map&lt;String,Person&gt; map = new HashMap&lt;&gt;();</div><div class="line">	map.put(&quot;dd&quot;, new Person(&quot;dd&quot;));</div><div class="line">	map.put(&quot;ee&quot;, new Person(&quot;ee&quot;));</div><div class="line">	map.put(&quot;ff&quot;, new Person(&quot;ff&quot;));</div><div class="line">	request.setAttribute(&quot;map&quot;, map);</div><div class="line">%&gt;</div><div class="line">$&#123;map.ee.name&#125;</div></pre></td></tr></table></figure></p>
<p>但map存储Key为数字时<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;% </div><div class="line">	Map&lt;String,Person&gt; map = new HashMap&lt;&gt;();</div><div class="line">	map.put(&quot;dd&quot;, new Person(&quot;dd&quot;));</div><div class="line">	map.put(&quot;ee&quot;, new Person(&quot;ee&quot;));</div><div class="line">	map.put(&quot;ff&quot;, new Person(&quot;ff&quot;));</div><div class="line">	map.put(&quot;11&quot;, new Person(&quot;11&quot;));</div><div class="line">	request.setAttribute(&quot;map&quot;, map);</div><div class="line">%&gt;</div><div class="line">$&#123;map[&apos;11&apos;].name&#125;</div></pre></td></tr></table></figure></p>
<p>用el表达式在取数据时，通常用’.’点号，但点号取不出来时用[]</p>
<p>拿到当前web应用路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$&#123;pageContext.request.contextPath&#125;  &lt;!-- /day09 --&gt;</div><div class="line">&lt;a href=&quot;$&#123;pageContext.request.contextPath&#125;/index.jsp&quot;&gt;首页&lt;/a&gt;</div></pre></td></tr></table></figure></p>
<h3 id="jstl"><a href="#jstl" class="headerlink" title="jstl"></a>jstl</h3><p>jstl是sun公司开发的一套标签库，使用jstl可以在页面中实现一些简单的逻辑，从而替换页面中的脚本代码<br>在页面中使用jstl需要2个步骤</p>
<ol>
<li>导入jstl.jar和standerd.jar则两个jar文件</li>
<li>在页面中使用&lt;@tablib url=”” prifix=””&gt; 元素导入标签库<br>jstl标签库中常用标签：<br>&lt;c:foreach var=”” items=””&gt;<br>&lt;c:if test=””&gt;</li>
</ol>
<h4 id="使用jstl"><a href="#使用jstl" class="headerlink" title="使用jstl"></a>使用jstl</h4><p>添加一个指令<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;</div></pre></td></tr></table></figure></p>
<p>遍历list中所有的元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;c:forEach var=&quot;person&quot; items=&quot;$&#123;list&#125;&quot;&gt;</div><div class="line">	$&#123;person.name&#125;</div><div class="line">&lt;/c:forEach&gt;</div></pre></td></tr></table></figure></p>
<p>遍历map中所有元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"> &lt;% </div><div class="line">	Map&lt;String,Person&gt; map = new HashMap&lt;&gt;();</div><div class="line">	map.put(&quot;dd&quot;, new Person(&quot;dd&quot;));</div><div class="line">	map.put(&quot;ee&quot;, new Person(&quot;ee&quot;));</div><div class="line">	map.put(&quot;ff&quot;, new Person(&quot;ff&quot;));</div><div class="line">	map.put(&quot;11&quot;, new Person(&quot;11&quot;));</div><div class="line">	request.setAttribute(&quot;map&quot;, map);</div><div class="line">%&gt;</div><div class="line">&lt;c:forEach var=&quot;entry&quot; items=&quot;$&#123;map&#125;&quot;&gt;</div><div class="line">	$&#123;entry.key&#125; : $&#123;entry.value.name&#125;</div><div class="line">&lt;/c:forEach&gt;</div></pre></td></tr></table></figure></p>
<p>当${map}时，程序拿到map集合后，会自动调用entrySet方法，得到一个关于entry的集合set</p>
<p>用测试语句测试用户是否登陆<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;c:if test=&quot;$&#123;user&#125;==null&quot;&gt;&lt;/c:if&gt;</div></pre></td></tr></table></figure></p>
<p>从四个域中获取user对象，并判断user是否为空</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://glbb.github.io/2018/01/09/el表达式和jstl快速入门/" data-id="cje9wqiyp000ipsvds6wiszwb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">三月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/03/02/监听器/">监听器</a>
          </li>
        
          <li>
            <a href="/2018/01/31/javamail发送邮件/">javamail发送邮件</a>
          </li>
        
          <li>
            <a href="/2018/01/26/java注解/">java注解</a>
          </li>
        
          <li>
            <a href="/2018/01/26/DButils/">DButils</a>
          </li>
        
          <li>
            <a href="/2018/01/25/元数据/">元数据</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>